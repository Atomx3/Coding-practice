# 项目需求

概述：多语言版本博客文档翻译

- 开发程序语言：python，请给程序逐行写英文注释；

- api：Google云计算，Vertex AI api，可定义使用的具体ai模型（Gemini pro/ ultra）；

备注：此前调用google translation api的方法已经过时了，因为该api不识别文档格式的语法标记，导致被翻译后的文件格式混乱。为了避免这种恶劣情况，需要在程序中定义文件格式语法标记，告诉翻译api哪些文本是可翻译，哪些是保留的标记，这增加了代码工作量；

- 源语言lan_source：此为源文件内容的人类自然语言版本（语言标签），程序通过ai自动识别源语言类别，也可在程序中定义，例如在程序中定义 lan_source = "zh-TW"；

- 语言标签： Vertex AI API 的多语种翻译功能使用 BCP 47 语言标签作为输入和输出的语言标识符，主要组成部分是ISO 639 标准中的语言代码，和ISO 3166 标准中的地区代码，例如 zh-TW台湾正体。

- 目标语言lan_target：把源文件内容翻译成我们想要的其他人类自然语言版本，文件的目录名称定义了目标语言，例如目录名 en 英文，de 德文，目录名并不一定与语言标签完全一致，例如目录zhs中文简体（语言标签 zh-CN ），en英文（不区分en-US美国英语 和 en-GB英国英语）；

- 源文件目录中可能有多级子目录、子文件等等，ai模型应该能识别并逐个检索并完成全部文件的翻译；

- 全部的目标语言目录及其文件结构与源语言目录保持一致，文件名也都是一样的，仅仅是目录名（en，de，zhs）不同。

- 本项目处理多语言版本的博客文件，在目标语言目录中持续有新的源语言文件，程序应跳过已经翻译成目标语言的文件，仅仅翻译新的源语言文件。例如en目录中大部分都是英文版本内容的文件，但是持续有源语言zh-TW的文件被添加进去，每次运行程序将其批量翻译成目标语言en。

- 程序会直接将翻译后的内容覆盖到目标语言目录中对应的源语言文件中，而不需要从源语言目录中复制文件到目标语言目录中。

# 文件格式
- 源文件格式：根据文件名后缀判断文件格式，如.md, .yaml, .xml等等。例如文件名以.md结尾，filename.md，属于markdown格式；
- 多格式并存：可能需要同时处理多种混合格式的文件，但是为了提高效率，我们尽可能每次只处理同一种格式文件；
- 自动检测文件格式：确保ai模型能理解不同格式的语法标记，根据格式类型选择相应的处理方案，能保留源文件格式，这是最重要的ai模型能力；


# 翻译内容特别注意事项
- 文件格式的语法标记是不可翻译的，例如md文件中带有markdown格式标记，必须保留翻译后的文件与源文件相同的格式；
- 引用圣经、名言、人名、地名、图书、电影名称、汉语成语和寓言等应该保留一份原文的源语言，同时一份对应翻译的目标语言；
- 文件目录名、文件名不要翻译，因为作为最终网页url的一部分，应始终保持其英文语言版本；



# 开发方法
ai模型目前还不能有效识别并保留文件的格式，因此需要在程序中处理文件格式解析问题。

**2. 利用现有的文件格式解析库:**

*   对于 Markdown，YAML，XML 和 HTML 这些常用的格式，Python 都有非常成熟的解析库，可以大大简化我们的工作。
*   **优势:**
    *   **准确性高:** 这些解析库是由专业的开发人员编写和维护的，能够准确解析各种文件格式，处理各种复杂的边界情况。
    *   **易于使用:** 这些库通常都提供了友好的 API，我们可以很方便地调用它们来解析文档。
    *   **效率高:** 解析库已经做了很多优化，可以高效地处理大型文档。
    *   **可扩展性好:** 如果将来需要支持新的文件格式，可以使用对应的解析库。
*   **常用的解析库:**
    *   **Markdown:** `markdown` (或者 `mistune`, `python-markdown`)
    *   **YAML:** `PyYAML`
    *   **XML:** `xml.etree.ElementTree` (Python 标准库) 或 `lxml`
    *   **HTML:** `Beautiful Soup 4`
*   **如何使用:**
    1.  **安装:** 使用 `pip` 安装你需要的库，例如：
        ``` pip install markdown PyYAML beautifulsoup4 lxml google-cloud-aiplatform ```
    2.  **导入:** 在 `file_handler.py` 中导入相应的库，例如：
        ```python
        import markdown
        import yaml
        from bs4 import BeautifulSoup
        import xml.etree.ElementTree as ET
        ```
    3.  **使用:**
        *   **Markdown:** 使用 `markdown.markdown(text)` 将 Markdown 文本转换为 HTML，然后解析 HTML 标签。
        *   **YAML:** 使用 `yaml.safe_load(text)` 将 YAML 文本解析为 Python 对象。
        *   **XML:** 使用 `ET.fromstring(text)` 将 XML 文本解析为 ElementTree 对象。
        *   **HTML:** 使用 `BeautifulSoup(text, 'html.parser')` 将 HTML 文本解析为 BeautifulSoup 对象。
    4.  **提取可翻译内容：**
        *   解析后，我们可以遍历 DOM (Document Object Model) 树，找到文本节点，并提取其内容，这些就是要翻译的内容。
        *   对于 XML/HTML，可以提取标签之间的文本内容。
        *   对于 YAML，可以提取 key-value pair 中 value 的部分。
        *   对于 markdown，可以先转为 HTML，然后按 HTML 方式提取。
        *   对于代码块、链接、图片等，直接保留不翻译。


# 问题
- 本项目所选用的ai模型能有效识别并保留源文件的格式（例如markdown，YAML等待）吗？
若ai能识别大部分的文件格式标记，那么我们就没必要采纳上面这些开发方法中的“文件格式解析库”，真是有点复杂，因为我们翻译后的文件依然保留原文件的格式标记，所以仅仅是翻译了有必要翻译的文本内容。
- ai模型能识别出哪些文本是待翻译的内容？哪些部分引用的文本应该保持原文不翻译呢？例如我们把英文圣经和经典句子翻译成中文，那么应该保留一份原文，同时翻译一份中文对照。
- c++也能做本项目开发，但相比较python而言，更复杂；

- 调用 Vertex AI api并选用 Gemini pro模型，是否需要先设置endpoint，并在Gemini 1.5 Pro 页面中下订单，将gemini-1.5-pro-002模型部署到一个服务器资源中，
但是1个 generative AI scale units (GSUs) SKU 单价高达2700美金/月，太贵了，我们仅仅是

需要这样复杂吗？不是可以通过Vertex AI api直接调用的吗？如同我们之前调用google translation api 做本项目文件翻译一样简单，如何简单就能调用Vertex AI api，请写一个测试api调用的小程序，以及如何正确在google cloud console中配置该api的方法。