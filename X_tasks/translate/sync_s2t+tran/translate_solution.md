# 项目需求
翻译项目，源语言文件在zhs目录，目标语言文件在其他目录，例如en，de，ru等。 
目标文件均翻译自zhs源文件。
要求完成翻译后，将本地文件目录都更新至远程github 库。


两种方法实现：
1. github的远程库中实现
只要zhs源文件目录中有文件内容更新，那么github action 就自动化运行，翻译源文件，并将结果存储到其他几个目标语言的文件目录中。  
参考代码文件 translate_github.py

2. 本地文件目录中实现  
只要zhs源文件目录中有文件内容更新，
git捕捉到这些更新的内容，那么手动输入一条命令，并调用了gpt api在本地目录中完成翻译，
并将结果存储到其他几个目标语言的本地文件目录中。  
参考代码文件 translate_local.py



## 特别注意
给zhs源语言和目标语言的文件中的段落做一一对应的标号记录，源文件的段落划分以新开的一行为标记。 
如果zhs源文件中的某些段落文本被删改，翻译脚本根据段落标号，迅速查找其他目标语言的目录文件中的对应的段落，如果某一段被整体删除，那么目标语言文件中对应的段落也被整体删除；  
若某一段中部分句子被删改，那么被删改的句子前后相邻的句子需要被重新翻译；  
对被删改的段落整体进行重新翻译，确保上下文的意义连贯性，翻译更准确；
所有文件中的文件名都保持原状而不被翻译，例如SUMARRY.md列表中的文件名。

根据您的需求和实现思路，这里是一个代码框架的示例。该脚本实现了 Git 检测源文件内容变化、段落编号元数据生成、变化段落的识别和翻译更新，并调用 OpenAI GPT API 将翻译内容同步到目标语言文件中。

### 文件结构
```plaintext
project/
├── zhs/
│   ├── source_file1.md
│   ├── source_file2.md
│   └── ...   
├── en/
│   ├── source_file1.md
│   ├── source_file2.md
│   └── ...   
├── de/
│   ├── source_file1.md
│   └── ...
├── ru/
│   └── ...
├── meta/
│   ├── source_file1.meta  # 段落元数据文件
│   ├── source_file2.meta
└── translate_local.py
```

### 代码示例

以下代码框架可以满足您的需求：
translate_local.py


### 代码说明

1. **`hash_paragraph`**：使用 MD5 哈希为每段生成唯一标识，用于比较和跟踪段落内容的变化。
2. **`parse_file`**：解析文件，将段落拆分为独立部分并生成段落哈希映射。
3. **`detect_changes`**：检测段落的新增、删除和修改，生成对应的变化记录并更新元数据文件。
4. **`translate_paragraph`**：使用 OpenAI 的 GPT API 翻译段落。
5. **`update_target_file`**：根据检测到的变化更新目标文件，调用翻译 API 处理新增或修改的段落，将删除的段落从目标文件中移除。
6. **`main`**：主函数，使用 Git 检测 `zhs` 目录中文件的变化，对有变动的文件执行翻译和同步更新。

### 注意事项

- **API 调用**：脚本中使用 OpenAI 的 GPT API，可以根据需要将 `temperature` 调整为更合适的值，以控制翻译的创意性。
- **元数据管理**：所有元数据存储在 `meta` 目录中，确保不影响源文件和翻译文件的内容。
- **Git 检测**：依赖 Git 检测 `zhs` 目录中文件的变化，便于捕捉更新段落。

### 使用方法

1. **初次执行**：运行脚本 `python translate_local.py` 初始化元数据文件。
2. **更新源文件**：在 `zhs` 目录中修改源文件内容。
3. **检测更新并翻译**：每次修改后运行脚本 `python translate_local.py` 检测变更并自动翻译同步。

这个框架适合内容更新频繁的项目，确保高效、准确地同步翻译内容。