# Meta元数据方案

## 块block的定义
不同格式的文件，其块block的定义方法不同，根据文件名的后缀可以判断其格式。

给每种文件格式一个独立的定义文件，如.md, .yaml, .xml等等格式，程序需为不同的定义文件一个预留的扩展接口，根据项目需求方便增减或修改定义文件。

以下是常见的文件格式和块block的定义方法。

### 文件.md 语法

1. **标题（Headers）**：
   - 每个标题（`#`, `##`, `###`, 等）标识一个新的块的开始。标题下的内容属于该块。

2. **列表（Lists）**：
   - 有序列表中的每个列表项视为一个独立的块；
   + 无序列表中的每个列表项视为一个独立的块，无序列表的标识符号包括星号 (*)、中划线 (-)、加号 (+)。

3. **代码块（Code Blocks）**：
   - 使用反引号（`  `）或缩进的代码块视为一个独立的块。

4. **引用（Blockquotes）**：
   - 使用 `>` 引导的引用块视为一个独立的块。

5. **表格（Tables）**：
   - 整个表格视为一个块。

6. **文本块（Text Blocks）**：
   - 连续的文本行（不包含空行）构成一个基本文本块。
   - 在一个基本文本块中，如果一行以句号、问号、感叹号等结束符号结尾，然后新开的一行开始新的内容，视为一个新的子块。
   - 如果在一行的末尾有两个连续的空格，根据 Markdown 的语法定义，这表示该行结束后会有一个强制换行，也可以视为一个新的子块。

7. **空行块**：
   - 连续的空行视为一个独立的块，用于分隔其他块。

8. **前置元数据块（Front Matter Blocks）**：
   - 在文件开头用三个短横线 `---` 包围的内容视为一个单独的块，即使其中包含空行。
   - 这种格式常用于静态网站生成器（如 Jekyll、Hugo）或文档工具中，用于提供文档的元信息。

## Markdown 解析

- 使用 Markdown 解析库来识别文档结构，结合自然语言处理（NLP）工具识别句子边界，以便更准确地划分子块。
- 在解析 Markdown 文档时，逐行检查文本，识别句子结束符号、换行符和空行，以确定块的边界。


## 块标识
两种方案：
哈希值，整数
- 为每个块生成一个唯一标识符，用于跟踪和比较内容变化。
- 标识符帮助快速定位和同步发生变化的块。



## 扩展性

- 为其他格式的文件设计插件机制，使得可以轻松添加新的元数据处理逻辑。
- 在程序中实现格式识别功能，根据文件类型选择相应的元数据处理方案。

## 性能优化

- 实现增量更新机制，仅更新修改的块，避免不必要的全文件复制。
- 考虑使用缓存来加速元数据的读取和写入操作。

由于要兼顾性能优化和效率，在初始化时，不宜立即给子块做元数据标号，因为工作量太大，所以只根据块的定义做大的块id标记。
当后续文件发生更改时，再酌情给部分更改的内容做子块标记，不必要给所有的块做其中的子块标记。


## 元数据优化要求

1. **文件路径记录**
   - 在meta文件顶部增加文件的完整目录路径url
   - 便于快速定位文件位置

2. **内容优化存储**
   - 仅记录内容块的前5个字符
   - 节省存储空间和计算资源

3. **多目录支持**
   - 为每个source和target目录创建独立的内容映射
     source：./zh/ ；target:./ru/, ./en/

   - 格式示例：
     "content": {
         "./zh/": "首字符",
         "./ru/": "首字符",
         "./en/": "首字符"
     }
     
   - 支持后续多语言翻译扩展
   - 保持文件结构一致性



## debugging
1. 仅当源文件被删除时，其meta文件也同步被删除；
2. meta文件中“content”内容也要包括源目录名，源目录与目标目录名并列；
3. 源文件或目标文件发生变更，meta文件始终跟踪记录，我们确保后续修改目标文件时，其block和id号不会改变，仅仅某个块的“content”内容被修改；
4. 不同的源和目标目录文件结构保持一致性，共享同一份meta文件；

README.md，SUMMARY.md是gitbook，jekyll，hugo等静态站生成器自定义的名称；且readme.md，文件名不分大小写，他们都是相同的。


## 相对路径链接
在Markdown格式文档中有一种特殊的链接，方法为 [about/README.md ](about/README.md "mention")，请解释一下 “mention” 的作用，为何有这种链接方法？

